// Generated by CoffeeScript 1.3.3
(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.getPreviousDepartementInfos=t(this.getPreviousDepartementInfos,this),this.numberFormat=t(this.numberFormat,this),this.hideTooltip=t(this.hideTooltip,this),this.displayTooltip=t(this.displayTooltip,this),this.updatePreviousLevelUrl=t(this.updatePreviousLevelUrl,this),this.updateSubTitle=t(this.updateSubTitle,this),this.pushNewStateFromUrl=t(this.pushNewStateFromUrl,this),this.extractStateFromUrl=t(this.extractStateFromUrl,this),this.updatePageComponents=t(this.updatePageComponents,this),this.generateNewLevelUrl=t(this.generateNewLevelUrl,this),this.generateUrl=t(this.generateUrl,this),this.generateTitle=t(this.generateTitle,this),this.generateNewHistoryState=t(this.generateNewHistoryState,this),this.getNodeColor=t(this.getNodeColor,this),this.getNodeCenter=t(this.getNodeCenter,this),this.moveTowardsCenter=t(this.moveTowardsCenter,this),this.charge=t(this.charge,this),this.updateNodeUrl=t(this.updateNodeUrl,this),this.updateCircleCenter=t(this.updateCircleCenter,this),this.updateCircleShape=t(this.updateCircleShape,this),this.updateCircleRichessePositionScale=t(this.updateCircleRichessePositionScale,this),this.updateCircleSizeScale=t(this.updateCircleSizeScale,this),this.updateNodeValue=t(this.updateNodeValue,this),this.getCurrentData=t(this.getCurrentData,this),this.getCurrentState=t(this.getCurrentState,this),this.updateNodes=t(this.updateNodes,this),this.updateVis=t(this.updateVis,this),this.createVis=t(this.createVis,this),this.start=t(this.start,this),this.initEvents=t(this.initEvents,this),this.appSettings={applicationRootUrl:window.appUrl||window.location.protocol+"//"+window.location.hostname,numberFormat:"# ##0."},this.graphSettings={width:$(".data").width(),height:$(".data").height(),layoutGravity:-0.01,damper:.07,animationSpeed:1e3,circleRange:{min:20,max:80},circleOpacity:.8},this.graphSettings.centers={receive:{x:Math.round(2.5*this.graphSettings.width/10),y:Math.round(this.graphSettings.height/2)},neutral:{x:Math.round(this.graphSettings.width/2),y:Math.round(this.graphSettings.height/2)},give:{x:Math.round(7.5*this.graphSettings.width/10),y:Math.round(this.graphSettings.height/2)}},this.graphSettings.colors={give:"#DD003F",neutral:"#F7C63C",receive:"#86BC31"},this.history=window.History,this.vis=null,this.nodes=[],this.force=null,this.circleSizeScale=null,this.circleRichesseRevenuPositionScale=null,this.circleRichessePotentielPositionScale=null,this.axeExtremeValues={revenu:{min:0,max:0},potentiel:{min:0,max:0}},this.currentState=null,this.rollbackState=null,this.updatePageComponents(),this.initEvents(),this.start(),this.createVis()}return e.prototype.initEvents=function(){var e,t=this;return e=this,$(document).ajaxError(function(e,t,n,r){if(t.status===403)return $("#unautorized").modal("show")}),$(document).ajaxStart(function(){return $("body").addClass("busy")}),$(document).ajaxStop(function(){return $("body").removeClass("busy")}),$(".perequation a").on("click",function(t){return t.preventDefault(),$(this).hasClass("disabled")?!1:e.generateNewHistoryState({perequation:$(this).attr("value"),change:"perequation"})}),$(".view_selector button").on("click",function(t){return t.preventDefault(),e.generateNewHistoryState({view:$(this).data("view"),change:"view"})}),$(".richesse_selector button").on("click",function(t){return t.preventDefault(),$(this).hasClass("disabled")||e.generateNewHistoryState({richesse:$(this).data("richesse"),change:"view"}),!1}),$(document).on("click",".data a, nav.perequation_level a.change_level",function(t){return t.preventDefault(),$(this).hasClass("disabled")||e.pushNewStateFromUrl($(this).attr("href")),!1}),$("#unautorized .rollback").on("click",function(e){return ga("send","event","subscription","no"),t.generateNewHistoryState(t.rollbackState,!0)}),$("#unautorized .identify").on("click",function(e){var n;return n=window.location.href,$(t).hasClass("register")?(ga("send","event","subscription","yes"),ga("send","event","subscription-from",n)):ga("send","event","subscription","identify"),window.location.href=encodeURI(""+t.appSettings.applicationRootUrl+"/identifier?url="+n)}),History.Adapter.bind(window,"statechange",function(){var n;return n=t.getCurrentState(),n.change==="perequation"?(e.updateNodeValue(),t.updateCircleShape(),t.updateNodeUrl(),t.force.start()):n.change==="view"?(t.updateNodeUrl(),t.force.start()):n.change==="level"&&e.updateVis(),t.updatePreviousLevelUrl(),t.updatePageComponents()})},e.prototype.start=function(){var e=this;return this.force=d3.layout.force().nodes(this.nodes).size([this.graphSettings.width,this.graphSettings.height]),this.force.gravity(this.graphSettings.layoutGravity).charge(this.charge).friction(.9).on("tick",function(t){return e.vis.selectAll("g.node").each(e.moveTowardsCenter(t.alpha)).attr("transform",function(e){return"translate("+e.x+","+e.y+")"})})},e.prototype.createVis=function(){var e=this;return this.vis=d3.select(".data").append("svg").attr("width",this.graphSettings.width).attr("height",this.graphSettings.height),this.vis.append("svg:defs").selectAll("marker").data(["endArrow"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",15).attr("markerHeight",15).attr("orient","auto").attr("fill","#555").append("svg:path").attr("d","M0,-5L10,0L0,5"),this.vis.append("g").attr("class","richesse-line").attr("opacity",this.currentState.view==="richesse"?1:0).append("svg:line").attr("x1",0).attr("y1",Math.round(this.graphSettings.height/2)).attr("x2",this.graphSettings.width).attr("y2",Math.round(this.graphSettings.height/2)).style("stroke","#555").style("stroke-width",1).attr("marker-end","url(#endArrow)"),this.vis.append("g").attr("class","min-value").attr("opacity",this.currentState.view==="richesse"?1:0).append("text").attr("x",0).attr("y",Math.round(this.graphSettings.height/2)+30).attr("fill","#555"),this.vis.append("g").attr("class","max-value").attr("opacity",this.currentState.view==="richesse"?1:0).append("text").attr("x",this.graphSettings.width).attr("y",Math.round(this.graphSettings.height/2)+30).attr("fill","#555").attr("text-anchor","end"),_.each(_.keys(this.graphSettings.colors),function(t){return $(".legende .color."+t).css("background-color",e.graphSettings.colors[t])}),d3.select(".data").append("div").attr("class","circle-tooltip"),this.updateVis()},e.prototype.updateVis=function(){var e,t=this;return e=this,this.updateNodes(function(){var n,r;return r=t.vis.selectAll("g.node").remove().data(t.nodes,function(e){return t.currentState.type+("_"+e.id)}),r.enter().append("g").attr("class","node").attr("id",function(e){return e.id}).attr("x",function(e){return e.x}).attr("y",function(e){return e.y}),n=r.append("circle").attr("r",0).attr("fill",function(e){return t.getNodeColor(e)}).attr("fill-opacity",t.graphSettings.circleOpacity).attr("stroke-width",1).attr("stroke",function(e){return d3.rgb(t.getNodeColor(e)).darker()}).on("mouseover",function(t){return e.displayTooltip(t,this)}).on("mouseout",function(t){return e.hideTooltip(this)}),r.append("a").attr("class","change_level").attr("xlink:href",function(e){return t.generateNewLevelUrl(e.levelId)}).attr("groupId",function(e){return e.id}).on("mouseover",function(t){return e.displayTooltip(t,this,!0)}).on("mouseout",function(t){return e.hideTooltip(this)}).append("text").attr("text-anchor","middle").attr("dy",".35em").text(function(e){return e.code}),r.call(t.force.drag),n.transition().duration(t.graphSettings.animationSpeed).attr("r",function(e){return e.radius}),t.currentState.richesse==="potentiel"?(d3.select("g.min-value text").text(""+t.numberFormat(t.axeExtremeValues.potentiel.min)+" €"),d3.select("g.max-value text").text(""+t.numberFormat(t.axeExtremeValues.potentiel.max)+" €")):(d3.select("g.min-value text").text(""+t.numberFormat(t.axeExtremeValues.revenu.min)+" €"),d3.select("g.max-value text").text(""+t.numberFormat(t.axeExtremeValues.revenu.max)+" €")),t.force.start(),t.hideTooltip()})},e.prototype.updateNodes=function(e){var t,n=this;return t=this.getCurrentState(),this.getCurrentData(t,function(r){return n.nodes.length=0,t.departementId=null,_.each(r,function(e,r,i){var s;return s={id:t.type+"_"+e.id,levelId:e.id,nom:e.nom,population:parseInt(e.population),revenu:{value:parseInt(e.revenu_hab),moyen:parseInt(e.revenu_hab_moyen),rang:parseInt(e.revenu_hab_rang)},fpic:{value:parseInt(e.fpic_2012),rang:parseInt(e.fpic_rang_2012),hab:parseFloat(e.fpic_hab_2012).toFixed(2),habRang:parseInt(e.fpic_hab_rang_2012)},total:{value:parseInt(e.total_2012),rang:parseInt(e.total_rang_2012),hab:parseFloat(e.total_hab_2012).toFixed(2),habRang:parseInt(e.total_hab_rang_2012)}},t.type==="france"?(s.code=e.code,s.dmto={value:parseInt(e.dmto_2012),rang:parseInt(e.dmto_rang_2012),hab:parseFloat(e.dmto_hab_2012).toFixed(2),habRang:parseInt(e.dmto_hab_rang_2012)}):t.type==="regions"?(s.code=n.leadingZero(e.id),s.potentielFiscal={value:parseInt(e.potentiel_fiscal_hab),moyen:parseInt(e.potentiel_fiscal_moyen),rang:parseInt(e.potentiel_fiscal_rang)},s.dmto={value:parseInt(e.dmto_2012),rang:parseInt(e.dmto_rang_2012),hab:parseFloat(e.dmto_hab_2012).toFixed(2),habRang:parseInt(e.dmto_hab_rang_2012)}):t.type==="departements"&&(s.potentielFiscal={value:parseInt(e.potentiel_fiscal_hab),moyen:parseInt(e.potentiel_fiscal_hab_moyen),rang:parseInt(e.potentiel_fiscal_hab_rang)},t.departementId||(t.departementId=e.departement_id)),n.nodes.push(s)}),n.updatePreviousLevelUrl(),n.updateNodeValue(),e()})},e.prototype.getCurrentState=function(){var e,t;return t=this.history.getState(),$.isEmptyObject(t.data)?(e=this.extractStateFromUrl(window.location.href),e?this.currentState=e:!1):this.currentState=t.data},e.prototype.getCurrentData=function(e,t){var n,r;r=this.currentState,n=null;if(r){switch(r.type){case"france":n={niveau:"regions",collectivite:"all"};break;case"regions":n={niveau:"departements/region",collectivite:r.id};break;case"departements":n={niveau:"intercos/departement",collectivite:r.id}}return $.ajax({url:this.appSettings.applicationRootUrl+"/api/"+n.niveau+"/"+n.collectivite,dataType:"json",success:function(e){return t(e)}})}return console.log("There is no defined state!")},e.prototype.updateNodeValue=function(){var e=this;return _.each(this.nodes,function(t,n,r){switch(e.currentState.perequation){case"dmto":return t.value=t.dmto.value;case"fpic":return t.value=t.fpic.value;default:return t.value=t.total.value}}),this.updateCircleSizeScale(),this.updateCircleRichessePositionScale()},e.prototype.updateCircleSizeScale=function(){var e,t,n,r,i=this;return r=_.min(this.nodes,function(e){return Math.abs(e.value)}),n=_.max(this.nodes,function(e){return Math.abs(e.value)}),this.nodes.length<30?(t=this.graphSettings.circleRange.min,e=this.graphSettings.circleRange.max):(t=this.graphSettings.circleRange.min/2,e=this.graphSettings.circleRange.max/2),this.circleSizeScale=d3.scale.linear().domain([Math.abs(r.value),Math.abs(n.value)]).range([t,e]),_.each(this.nodes,function(e,t,n){return e.radius=i.circleSizeScale(Math.abs(e.value))})},e.prototype.updateCircleRichessePositionScale=function(){var e,t,n,r;r=_.min(this.nodes,function(e){return e.revenu.value}),t=_.max(this.nodes,function(e){return e.revenu.value}),this.axeExtremeValues.revenu.min=r.revenu.value,this.axeExtremeValues.revenu.max=t.revenu.value,this.circleRichesseRevenuPositionScale=d3.scale.linear().domain([r.revenu.value,t.revenu.value]).range([this.graphSettings.centers.receive.x-50,this.graphSettings.centers.give.x+50]);if(this.currentState.type==="regions")return n=_.min(this.nodes,function(e){return e.potentielFiscal.value}),e=_.max(this.nodes,function(e){return e.potentielFiscal.value}),this.axeExtremeValues.potentiel.min=n.potentielFiscal.value,this.axeExtremeValues.potentiel.max=e.potentielFiscal.value,this.circleRichessePotentielPositionScale=d3.scale.linear().domain([n.potentielFiscal.value,e.potentielFiscal.value]).range([this.graphSettings.centers.receive.x-50,this.graphSettings.centers.give.x+50])},e.prototype.updateCircleShape=function(){var e=this;return this.vis.selectAll("circle").data(this.nodes,function(t){return e.currentState.type+("_"+t.id)}).transition().duration(this.graphSettings.animationSpeed).attr("r",function(e){return e.radius}).attr("fill",function(t){return e.getNodeColor(t)}).attr("stroke",function(t){return d3.rgb(e.getNodeColor(t)).darker()})},e.prototype.updateCircleCenter=function(){var e=this;return this.centers.length=0,_.each(this.nodes,function(t,n,r){return t.center=e.getNodeCenter(t)})},e.prototype.updateNodeUrl=function(){var e=this;return this.vis.selectAll("a").attr("xlink:href",function(t){return e.generateNewLevelUrl(t.levelId)})},e.prototype.charge=function(e){return-Math.pow(e.radius,2)/8},e.prototype.moveTowardsCenter=function(e){var t=this;return function(n){var r;return r=t.getNodeCenter(n),n.x=n.x+(r.x-n.x)*(t.graphSettings.damper+.02)*e*1.1,n.y=n.y+(r.y-n.y)*(t.graphSettings.damper+.02)*e*1.1}},e.prototype.getNodeCenter=function(e){var t;return this.currentState.view==="donnees"?e.value>999?this.graphSettings.centers.receive:e.value<-999?this.graphSettings.centers.give:this.graphSettings.centers.neutral:this.currentState.type==="regions"&&this.currentState.richesse==="potentiel"?t={x:this.circleRichessePotentielPositionScale(e.potentielFiscal.value),y:this.graphSettings.height/2}:t={x:this.circleRichesseRevenuPositionScale(e.revenu.value),y:this.graphSettings.height/2}},e.prototype.getNodeColor=function(e){return e.value>999?this.graphSettings.colors.receive:e.value<-999?this.graphSettings.colors.give:this.graphSettings.colors.neutral},e.prototype.generateNewHistoryState=function(e,t){var n,r,i;return t==null&&(t=!1),this.rollbackState=_.clone(this.currentState),t?this.currentState=e:_.extend(this.currentState,e),r=this.generateTitle(this.currentState),i=this.generateUrl(),n=i.replace(this.appSettings.applicationRootUrl,""),ga("send","pageview",{page:n,title:r}),History.pushState(this.currentState,r,i)},e.prototype.generateTitle=function(e){var t;t="A qui profitent les péréquations :";switch(this.currentState.view){case"donnees":t+=" Données";break;case"richesse":t+=" Richesse";break;case"comparer":t+=" Comparer"}switch(this.currentState.perequation){case"toutes":t+=" - Toutes les péréquations";break;case"dmto":t+=" - DMTO";break;case"fpic":t+=" - FPIC"}switch(this.currentState.type){case"france":t+=" - France";break;case"regions":t+=" - Région:";break;case"departements":t+=" - Département:"}return(this.currentState.type==="regions"||this.currentState.type==="departements")&&this.currentState.id&&(this.currentState.name?t+=" "+this.currentState.name:t+=" "+this.currentState.id),t},e.prototype.generateUrl=function(e){var t,n;return t=_.clone(this.currentState),_.extend(t,e),n=this.appSettings.applicationRootUrl+"/"+t.view+"/"+t.perequation+"/"+t.type,t.id&&(n+="/"+t.id),t.view==="richesse"&&t.richesse&&(n+="/"+t.richesse),n},e.prototype.generateNewLevelUrl=function(e,t){var n;return e==null&&(e=""),t==null&&(t=!0),n={type:null,id:null},t?(this.currentState.type==="france"&&(n.type="regions"),this.currentState.type==="regions"&&(n.type="departements",n.perequation="fpic"),n.richesse="revenu",n.id=e):(this.currentState.type==="regions"&&(n.type="france",this.currentState.view==="richesse"&&(n.richesse="revenu")),this.currentState.type==="departements"&&(n.type="regions"),n.id=e),this.generateUrl(n)},e.prototype.updatePageComponents=function(){return this.currentState||this.getCurrentState(),$(".perequation .btn.active").removeClass("active"),$(".perequation .btn."+this.currentState.perequation).addClass("active"),this.currentState.type==="regions"?$(".notice.richesse .departement").show():$(".notice.richesse .departement").hide(),this.currentState.type==="departements"?$(".perequation .btn:not(.fpic)").addClass("disabled"):$(".perequation .btn.disabled").removeClass("disabled"),this.currentState.view==="richesse"?(d3.selectAll("g.richesse-line, g.min-value, g.max-value").transition().duration(this.graphSettings.animationSpeed/2).attr("opacity",1),d3.selectAll("g.group-label").transition().duration(this.graphSettings.animationSpeed/2).attr("opacity",0),$(".notices").removeClass("donnees").addClass("richesse")):(d3.selectAll("g.richesse-line, g.min-value, g.max-value").transition().duration(this.graphSettings.animationSpeed/2).attr("opacity",0),d3.selectAll("g.group-label").transition().duration(this.graphSettings.animationSpeed/2).attr("opacity",1),$(".notices").removeClass("richesse").addClass("donnees")),this.currentState.view==="richesse"?($(".view_selector .donnees").removeClass("active"),$(".view_selector .richesse").addClass("active"),$(".richesse_selector").css("visibility","visible"),this.currentState.type==="regions"?$(".richesse_selector .btn.disabled").removeClass("disabled"):$(".richesse_selector .btn:not(.revenu)").addClass("disabled"),this.currentState.richesse==="potentiel"?($(".richesse_selector .potentiel").addClass("active"),$(".richesse_selector .revenu").removeClass("active"),d3.select("g.min-value text").text(""+this.numberFormat(this.axeExtremeValues.potentiel.min)+" €"),d3.select("g.max-value text").text(""+this.numberFormat(this.axeExtremeValues.potentiel.max)+" €")):($(".richesse_selector .potentiel").removeClass("active"),$(".richesse_selector .revenu").addClass("active"),d3.select("g.min-value text").text(""+this.numberFormat(this.axeExtremeValues.revenu.min)+" €"),d3.select("g.max-value text").text(""+this.numberFormat(this.axeExtremeValues.revenu.max)+" €"))):($(".richesse_selector").css("visibility","hidden"),$(".view_selector .donnees").addClass("active"),$(".view_selector .richesse").removeClass("active")),this.updateSubTitle()},e.prototype.extractStateFromUrl=function(e){var t,n,r;return r=new RegExp("^"+this.appSettings.applicationRootUrl+"/(donnees|richesse|comparer)/(toutes|dmto|fpic)/(france|regions|departements)/?([0-9A-B]{1,3})?/?(potentiel|revenu)?$"),n=r.exec(e),n?(t={view:n[1],perequation:n[2],type:n[3],id:n[4],richesse:n[5]},t.type!=="regions"&&t.view==="richesse"&&(t.richesse="revenu"),t.type==="departements"&&(t.perequation="fpic"),t):null},e.prototype.pushNewStateFromUrl=function(e){var t;return t=this.extractStateFromUrl(e),t.change="level",this.generateNewHistoryState(t)},e.prototype.updateSubTitle=function(){var e;switch(this.currentState.type){case"france":e="Les données par régions";break;case"regions":e="Les départements de la région "+this.getLevelCollectiviteName(this.currentState.type,this.currentState.id);break;case"departements":e="Les intercommunalités du département "+this.getLevelCollectiviteName(this.currentState.type,this.currentState.id)}return $("nav.perequation_level h2").text(e)},e.prototype.updatePreviousLevelUrl=function(){var e;if(this.currentState.type==="france")return $("nav.perequation_level .change_level").css("visibility","hidden"),$("nav.perequation_level .change_level").attr("href",this.generateUrl());if(this.currentState.type==="regions")return $("nav.perequation_level .change_level .level_name").text("Les données par régions"),$("nav.perequation_level .change_level").css("visibility","visible"),$("nav.perequation_level .change_level").attr("href",this.generateNewLevelUrl(null,!1));if(this.currentState.type==="departements")return $("nav.perequation_level .change_level").css("visibility","visible"),e=this.getPreviousDepartementInfos(this.currentState.departementId),$("nav.perequation_level .change_level .level_name").text("Les départements de la région "+this.getLevelCollectiviteName("regions",e)),$("nav.perequation_level .change_level").attr("href",this.generateNewLevelUrl(e,!1))},e.prototype.displayTooltip=function(e,t,n){var r,i,s,o,u;return n==null&&(n=!1),n&&(i=d3.select(t).attr("groupId"),t=d3.select("g#"+i+" circle")[0][0]),d3.select(t).attr("fill-opacity",1),r='<div class="title">'+e.nom+"</div>            <ul>                <li class='header'>Population</li>",isNaN(e.population)?r+="<li>Données non disponibles</li>":r+="<li>"+format(this.appSettings.numberFormat,e.population)+" habitants</li>",r+="<li class='header'>Revenu par habitant</li>                <li>"+format(this.appSettings.numberFormat,e.revenu.value)+" &euro; / Rang : "+e.revenu.rang+"</li>                <li>Moyenne nationale : "+format(this.appSettings.numberFormat,e.revenu.moyen)+" &euro;</li>                <li class='header'>Perequations</li>            ",isNaN(e.total.habRang)?r+="<li class='section'><b>Total par habitant : "+this.numberFormat(e.total.hab)+" &euro; / Rang : non applicable</b></li>":r+="<li class='section'><b>Total par habitant : "+this.numberFormat(e.total.hab)+" &euro; / Rang : "+e.total.habRang+"</b></li>",isNaN(e.total.rang)?r+="<li>Total : "+this.numberFormat(e.total.value)+" &euro; / Rang : non applicable</li>":r+="<li>Total : "+this.numberFormat(e.total.value)+" &euro; / Rang : "+e.total.rang+"</li>",isNaN(e.fpic.habRang)?r+="<li class='section'><b>FPIC par habitant : "+this.numberFormat(e.fpic.hab)+" &euro; / Rang : non applicable</b></li>":r+="<li class='section'><b>FPIC par habitant : "+this.numberFormat(e.fpic.hab)+" &euro; / Rang : "+e.fpic.habRang+"</b></li>",isNaN(e.fpic.rang)?r+="<li>FPIC : "+this.numberFormat(e.fpic.value)+" &euro; / Rang : non applicable</li>":r+="<li>FPIC : "+this.numberFormat(e.fpic.value)+" &euro; / Rang : "+e.fpic.rang+"</li>",this.currentState.type!=="departements"&&(isNaN(e.dmto.habRang)?r+="<li class='section'><b>DMTO par habitant : "+this.numberFormat(e.dmto.hab)+" &euro; / Rang : non applicable</b></li>":r+="<li class='section'><b>DMTO par habitant : "+this.numberFormat(e.dmto.hab)+" &euro; / Rang : "+e.dmto.habRang+"</b></li>",isNaN(e.dmto.rang)?r+="<li>DMTO : "+this.numberFormat(e.dmto.value)+" &euro; / Rang : non applicable</li>":r+="<li>DMTO : "+this.numberFormat(e.dmto.value)+" &euro; / Rang : "+e.dmto.rang+"</li>"),this.currentState.type!=="france"&&e.potentielFiscal&&e.potentielFiscal.value&&(r+="<li class='header'>Potentiel fiscal par habitant</li>                        <li>"+this.numberFormat(e.potentielFiscal.value)+" &euro; / Rang : "+e.potentielFiscal.rang+"</li>                        <li>Moyenne nationale : "+this.numberFormat(e.potentielFiscal.moyen)+" &euro;</li>"),r+="</ul>",u=$(".circle-tooltip"),u.css("height","auto"),u.html(r),s=u.height(),u.removeAttr("style"),o={top:Math.round(e.y-s/2-10)+"px"},e.x<this.graphSettings.width/2?(o.left=Math.round(e.x+50)+"px",u.removeClass("right"),u.addClass("left")):(o.right=Math.round(this.graphSettings.width-e.x+50)+"px",u.removeClass("left"),u.addClass("right")),u.css(o),u.addClass("show")},e.prototype.hideTooltip=function(e){return e==null&&(e=!1),e&&d3.select(e).attr("fill-opacity",this.graphSettings.circleOpacity),$(".circle-tooltip").removeClass("show")},e.prototype.leadingZero=function(e){return String(e).length===1?"0"+e:String(e)},e.prototype.numberFormat=function(e){return parseInt(e)>0?"+ "+format(this.appSettings.numberFormat,e):format(this.appSettings.numberFormat,e)},e.prototype.getLevelCollectiviteName=function(e,t){var n,r;r={11:"Ile-de-France",21:"Champagne-Ardenne",22:"Picardie",23:"Haute-Normandie",24:"Centre",25:"Basse-Normandie",26:"Bourgogne",31:"Nord-Pas-de-Calais",41:"Lorraine",42:"Alsace",43:"Franche-Comté",52:"Pays-de-La-Loire",53:"Bretagne",54:"Poitou-Charentes",72:"Aquitaine",73:"Midi-Pyrénées",74:"Limousin",82:"Rhone-Alpes",83:"Auvergne",91:"Languedoc-Roussillon",93:"Provence-Alpes-Côte-d'Azur",94:"Corse"},n={62:"Pas-de-Calais",57:"Moselle",67:"Bas-Rhin",49:"Maine-et-Loire",29:"Finistère",22:"Côtes-dArmor",2:"Aisne",71:"Saône-et-Loire",42:"Loire",23:"Creuse",54:"Meurthe-et-Moselle",72:"Sarthe",63:"Puy-de-Dôme",50:"Manche",80:"Somme",36:"Indre",27:"Eure",52:"Haute-Marne",88:"Vosges",48:"Lozère",43:"Haute-Loire",86:"Vienne",79:"Deux-Sèvres",53:"Mayenne",70:"Haute-Saône",81:"Tarn",55:"Meuse",15:"Cantal",3:"Allier",24:"Dordogne",8:"Ardennes",61:"Orne",12:"Aveyron",47:"Lot-et-Garonne",25:"Doubs",16:"Charente",7:"Ardèche",58:"Nièvre",87:"Haute-Vienne",19:"Corrèze",89:"Yonne",18:"Cher",65:"Hautes-Pyrénées",9:"Ariège",41:"Loir-et-Cher",32:"Gers",46:"Lot",82:"Tarn-et-Garonne",39:"Jura",10:"Aube","2B":"Haute-Corse",90:"Territoire de Belfort",5:"Hautes-Alpes",4:"Alpes-de-Haute-Provence",11:"Aude",28:"Eure-et-Loir",51:"Marne",45:"Loiret",37:"Indre-et-Loire",85:"Vendée",40:"Landes",21:"Côte-dOr",66:"Pyrénées-Orientales",68:"Haut-Rhin",56:"Morbihan",60:"Oise",30:"Gard",14:"Calvados",1:"Ain",35:"Ille-et-Vilaine","2A":"Corse-du-Sud",64:"Pyrénées-Atlantiques",26:"Drôme",17:"Charente-Maritime",76:"Seine-Maritime",84:"Vaucluse",34:"Hérault",73:"Savoie",31:"Haute-Garonne",95:"Val-dOise",77:"Seine-et-Marne",38:"Isère",44:"Loire-Atlantique",33:"Gironde",59:"Nord",93:"Seine-Saint-Denis",91:"Essonne",74:"Haute-Savoie",94:"Val-de-Marne",13:"Bouches-du-Rhône",83:"Var",69:"Rhône",78:"Yvelines",6:"Alpes-Maritimes",92:"Hauts-de-Seine",75:"Paris"};if(e==="regions")return r[String(t)];if(e==="departements")return n[String(t)]},e.prototype.getPreviousDepartementInfos=function(e){var t;return t={1:"82",10:"21",11:"91",12:"73",13:"93",14:"25",15:"83",16:"54",17:"54",18:"24",19:"74",2:"22","2A":"94","2B":"94",21:"26",22:"53",23:"74",24:"72",25:"43",26:"82",27:"23",28:"24",29:"53",3:"83",30:"91",31:"73",32:"73",33:"72",34:"91",35:"53",36:"24",37:"24",38:"82",39:"43",4:"93",40:"72",41:"24",42:"82",43:"83",44:"52",45:"24",46:"73",47:"72",48:"91",49:"52",5:"93",50:"25",51:"21",52:"21",53:"52",54:"41",55:"41",56:"53",57:"41",58:"26",59:"31",6:"93",60:"22",61:"25",62:"31",63:"83",64:"72",65:"73",66:"91",67:"42",68:"42",69:"82",7:"82",70:"43",71:"26",72:"52",73:"82",74:"82",75:"11",76:"23",77:"11",78:"11",79:"54",8:"21",80:"22",81:"73",82:"73",83:"93",84:"93",85:"52",86:"54",87:"74",88:"41",89:"26",9:"73",90:"43",91:"11",92:"11",93:"11",94:"11",95:"11"},t[String(e)]},e}(),$(function(){if($("#app").length>0)return new e})}).call(this);